<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Orders</title>

    <!-- Import TailwindCSS and FontAwesome -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@400;700&display=swap"
        rel="stylesheet" />

    <style>
        body {
            font-family: 'Playfair Display', serif;
            background: url('https://images.unsplash.com/photo-1526234362653-3b75a0c07438?q=80&w=1932&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center center fixed;
            background-size: cover;
            color: #ECDFCC;
        }

        .orders-container {
            background-color: rgba(60, 61, 55, 0.8);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            padding: 40px;
            margin-bottom: 20px;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .orders-container:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .btn-primary {
            background-color: #697565;
            border-color: #697565;
            color: #fff;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #3C3D37;
            border-color: #3C3D37;
        }

        .hover-scale {
            transition: transform 0.3s ease-in-out;
        }

        .hover-scale:hover {
            transform: scale(1.05);
        }

        .success-message {
            background-color: rgba(144, 238, 144, 0.8);
            border: 1px solid green;
            color: green;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 8px;
            animation: fadeIn 1s ease-in-out;
        }

        .error-message {
            background-color: rgba(255, 99, 71, 0.8);
            border: 1px solid red;
            color: rgb(255, 255, 255);
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 8px;
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #3C3D37;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            color: white;
            border-radius: 10px;
        }

        .modal-footer {
            text-align: right;
        }

        .modal-footer button {
            margin-left: 10px;
        }
    </style>
</head>

<body class="bg-gray-100">
    <!-- Navbar -->
    <%- include('../partials/navbar') %>

    <div class="container mx-auto mt-10 fade-in">
        <h2 class="text-5xl font-bold mb-10 text-center text-[#4b3a36]">Your Orders at table # <%= tableNumber %></h2>

        <!-- Flash Messages -->
        <% if (flashMessages.success_msg) { %>
        <div class="success-message">
            <strong>Success!</strong>
            <%= flashMessages.success_msg %>
        </div>
        <% } %>
        <% if (flashMessages.error_msg) { %>
        <div class="error-message">
            <strong>Error!</strong>
            <%= flashMessages.error_msg %>
        </div>
        <% } %>

        <div class="orders-container">
            <h3 class="text-3xl font-bold mb-6">Order List</h3>
            <% if (orders && orders.length > 0) { %>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-transparent text-light">
                    <thead>
                        <tr>
                            <th class="py-4 px-6 border-b text-left">Order ID</th>
                            <th class="py-4 px-6 border-b text-left">Status</th>
                            <th class="py-4 px-6 border-b text-left">Payment Status</th>
                            <th class="py-4 px-6 border-b text-left">Total Price</th>
                            <th class="py-4 px-6 border-b text-left">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% let totalPrice = 0; %>
                        <% orders.forEach(order => { %>
                        <tr>
                            <td class="py-2 px-6 border-b">
                                <%= order._id %>
                            </td>
                            <td class="py-2 px-6 border-b">
                                <%= order.status %>
                            </td>
                            <td class="py-2 px-6 border-b">
                                <% if (order.paymentStatus === 'paid') { %>
                                <span class="text-green-500">Paid</span>
                                <% } else { %>
                                <span class="text-red-500">Unpaid</span>
                                <% } %>
                            </td>
                            <td class="py-2 px-6 border-b">₹<%= order.total %></td>
                            <td class="py-2 px-6 border-b flex items-center space-x-2">
                                <a href="/customer/orders/<%= order._id %>"
                                    class="text-white bg-blue-500 hover:bg-blue-700 py-2 px-4 rounded transition duration-300 ease-in-out transform hover:scale-105">View</a>
                                <% if (order.status === 'pending') { %>
                                <form action="/orders/cancel/<%= order._id %>" method="POST" style="display:inline;">
                                    <button type="submit"
                                        class="text-white bg-red-500 hover:bg-red-700 py-2 px-4 rounded transition duration-300 ease-in-out transform hover:scale-105"
                                        onclick="return confirm('Are you sure you want to cancel this order?');">Cancel</button>
                                </form>
                                <% } else { %>
                                <span class="bg-gray-500 text-white py-2 px-4 rounded">Cannot Cancel</span>
                                <% } %>
                            </td>
                        </tr>
                        <% totalPrice += order.total; %>
                        <% }) %>
                    </tbody>
                </table>
            </div>

            <!-- Show Total Price and Payment Option -->
            <div class="mt-6">
                <h3 class="text-2xl font-bold text-white">Total Price for All Orders: ₹<%= totalPrice %></h3>
                <button type="button"
                    class="text-white bg-green-500 hover:bg-green-700 py-2 px-4 rounded transition duration-300 ease-in-out transform hover:scale-105 mt-4"
                    onclick="openBillingModal()">Proceed to Billing</button>
            </div>
            <% } else { %>
            <p class="text-gray-500">No orders found.</p>
            <% } %>
        </div>
    </div>

    <!-- Modal for billing confirmation -->
    <div id="billingModal" class="modal">
        <div class="modal-content">
            <h3 class="text-2xl font-bold mb-4">Confirm Billing</h3>
            <p>Are you sure you want to proceed with the billing? Once the payment is made, your table will be marked as vacant, and further orders for this session will not be allowed. Please ensure you have completed your meal before proceeding.</p>
            <div class="modal-footer mt-4">
                <button onclick="closeBillingModal()"
                    class="text-gray-500 bg-gray-300 hover:bg-gray-400 py-2 px-4 rounded">Cancel</button>
                <form action="/customer/orders/<%= tableNumber %>/pay" method="POST" class="inline">
                    <button type="submit"
                        class="text-white bg-green-500 hover:bg-green-700 py-2 px-4 rounded transition duration-300 ease-in-out">Proceed to Payment</button>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" crossorigin="anonymous"></script>
    <script>
        // Open the billing modal
        function openBillingModal() {
            document.getElementById('billingModal').style.display = 'block';
        }

        // Close the billing modal
        function closeBillingModal() {
            document.getElementById('billingModal').style.display = 'none';
        }

        // GSAP Animations
        gsap.from('.orders-container', {
            duration: 1,
            y: 50,
            opacity: 0,
            stagger: 0.2
        });
    </script>
</body>

</html>
